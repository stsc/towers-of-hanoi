<!--
#
# towers-of-hanoi - Simple web-based towers of hanoi implementation
#
# Copyright (c) 2009, 2025 Steven Schubiger
#
# This program is free software: you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation, either version 3 of the License, or
# (at your option) any later version.
#
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License
# along with this program.  If not, see <http://www.gnu.org/licenses/>.
#
-->
<html lang="en">
  <head>
    <meta name="author" content="Steven Schubiger">
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <link rel="shortcut icon" type="image/x-icon" href="favicon.ico">
    <title>Towers of Hanoi</title>
    <link rel="stylesheet" type="text/css" href="style.css">
    <script src="js/prototype.js" type="text/javascript"></script>
    <script src="js/scriptaculous.js" type="text/javascript"></script>
    <script src="js/effects.js" type="text/javascript"></script>
    <script src="js/dragdrop.js" type="text/javascript"></script>
    <script src="js/controls.js" type="text/javascript"></script>
  </head>
  <body>
    <div class="center">
      <b style="font-size:20px">TOWERS OF HANOI</b> [<a href="https://en.wikipedia.org/wiki/Tower_of_Hanoi" target="_blank" style="font-size:15px">wikipedia</a>]
      <ol>
        <li><i>Only one disk</i> may be moved at a time.</li>
        <li>Each move consists of taking the <i>upper disk from one of the stacks</i> and placing it <i>on top of another stack</i> or on an <i>empty rod</i>.</li>
        <li><i>No disk may be placed on top of a disk that is smaller than it.</i></li>
      </ol>
    </div>
    <table align="center">
      <tr>
        <td align="center"><div id="1" class="rings"><div id="1_inner" class="ring_first">1</div></div></td>
        <td align="center"><div id="5" class="rings"><div id="5_inner" class="ring_blank">0</div></div></td>
        <td align="center"><div id="9" class="rings"><div id="9_inner" class="ring_blank">0</div></div></td>
      </tr>
      <tr>
        <td align="center"><div id="2" class="rings"><div id="2_inner" class="ring_second">2</div></div></td>
        <td align="center"><div id="6" class="rings"><div id="6_inner" class="ring_blank">0</div></div></td>
        <td align="center"><div id="10" class="rings"><div id="10_inner" class="ring_blank">0</div></div></td>
      </tr>
      <tr>
        <td align="center"><div id="3" class="rings"><div id="3_inner" class="ring_third">3</div></div></td>
        <td align="center"><div id="7" class="rings"><div id="7_inner" class="ring_blank">0</div></div></td>
        <td align="center"><div id="11" class="rings"><div id="11_inner" class="ring_blank">0</div></div></td>
      </tr>
      <tr>
        <td align="center"><div id="4" class="rings"><div id="4_inner" class="ring_fourth">4</div></div></td>
        <td align="center"><div id="8" class="rings"><div id="8_inner" class="ring_blank">0</div></div></td>
        <td align="center"><div id="12" class="rings"><div id="12_inner" class="ring_blank">0</div></div></td>
      </tr>
      <tr>
        <td align="left"><a href="javascript:location.reload()">reset</a> -- [ <span id="moves">0</span> moves ] -- <span id="progress">READY.</span></td>
        <td></td>
        <td align="right"><code>v0.01</code></td>
      </tr>
    </table>
  <script>

function exchange(element, dropon, event) {
    let move = false, ring_top = 1, to_pos;

    let rings = new Array(3);
    let pos   = new Array(1,4);

    for (let i = 0; i < rings.length; i++) {
        rings[i] = new Array(pos[0], pos[1]);
        pos[0] += 4;
        pos[1] += 4;
    }

    GATHER_POS: for (let i = 0; i < rings.length; i++) {
        if (dropon.id >= rings[i][0]
         && dropon.id <= rings[i][1]
        ) {
            for (let c = rings[i][1]; c >= rings[i][0]; c--) {
                const div_inner = c + '_inner';
                const class_name = document.getElementById(div_inner).className;
                if (class_name == 'ring_blank') {
                    move = true;
                    to_pos = c;
                    break GATHER_POS;
                }
            }
        }
    }
    CHECK_IF_TOP: for (let i = 0; i < rings.length; i++) {
        if (element.parentNode.id >= rings[i][0]
         && element.parentNode.id <= rings[i][1]
        ) {
            for (let c = rings[i][1]; c >= rings[i][0]; c--) {
                const div_inner = c + '_inner';
                const class_name = document.getElementById(div_inner).className;
                if (class_name == 'ring_blank') {
                    ring_top = c + 1;
                    break CHECK_IF_TOP;
                } // allow for full stack to be emptied (unless final one)
                else if (c == rings[i][0] && element.parentNode.id != 9) {
                    ring_top = c;
                    break CHECK_IF_TOP;
                }
            }
        }
    }

    if (element.parentNode.id == ring_top && (
        dropon.id % 4 == 0
          ? document.getElementById(dropon.id).firstChild.className == 'ring_blank'
          : Number(document.getElementById(Number(dropon.id) + 1).firstChild.textContent) > Number(element.textContent))
    ) {
        const from_id = element.parentNode.id;
        const to_id   = dropon.id;

        const from_class = $(from_id).firstChild.className;
        let to_class     = $(to_id).firstChild.className;

        const from_text = $(from_id).firstChild.textContent;
        let to_text     = $(to_id).firstChild.textContent;

        const from_inner = from_id + '_inner';
        let to_inner     = to_id   + '_inner';

        if (move) {
            to_inner = to_pos + '_inner';
            to_class = 'ring_blank';
            to_text  = '0';
        }

        document.getElementById(from_inner).className = to_class;
        document.getElementById(to_inner).className   = from_class;

        document.getElementById(from_inner).textContent = to_text;
        document.getElementById(to_inner).textContent   = from_text;

        if (dropon.id == 9) {
            for (let id = 9; id <= 12; id++) {
                document.getElementById(id).firstChild.style.backgroundColor = 'darkcyan';
            }
        }

        const moves = document.getElementById('moves').textContent;
        document.getElementById('moves').textContent = Number(moves) + 1;

        document.getElementById('progress').textContent = dropon.id == 9 ? 'DONE!' : 'SOLVING..';
    }
}

new Draggable('1_inner',  { revert: true });
new Draggable('2_inner',  { revert: true });
new Draggable('3_inner',  { revert: true });
new Draggable('4_inner',  { revert: true });
new Draggable('5_inner',  { revert: true });
new Draggable('6_inner',  { revert: true });
new Draggable('7_inner',  { revert: true });
new Draggable('8_inner',  { revert: true });
new Draggable('9_inner',  { revert: true });
new Draggable('10_inner', { revert: true });
new Draggable('11_inner', { revert: true });
new Draggable('12_inner', { revert: true });

Droppables.add('1',  { onDrop: exchange });
Droppables.add('2',  { onDrop: exchange });
Droppables.add('3',  { onDrop: exchange });
Droppables.add('4',  { onDrop: exchange });
Droppables.add('5',  { onDrop: exchange });
Droppables.add('6',  { onDrop: exchange });
Droppables.add('7',  { onDrop: exchange });
Droppables.add('8',  { onDrop: exchange });
Droppables.add('9',  { onDrop: exchange });
Droppables.add('10', { onDrop: exchange });
Droppables.add('11', { onDrop: exchange });
Droppables.add('12', { onDrop: exchange });

  </script>
  </body>
</html>
